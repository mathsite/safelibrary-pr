<!DOCTYPE html>
<html lang="en">
<head>
  <script src="https://houselearning.github.io/cookiebanner.js"></script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Programs | SafeLibrary</title>
  <style>
    /* Global box-sizing */
    * { box-sizing: border-box; }

    /* Body styling for overall layout and theme transitions */
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f9f9f9;
      color: #333;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      transition: background 0.3s, color 0.3s;
    }
    body.dark-mode { background: #121212; color: #f1f1f1; }

    /* Navbar styling for navigation links */
    .navbar {
      background-color: #20232a;
      display: flex;
      overflow-x: auto;
      white-space: nowrap;
      padding: 12px 20px;
      box-shadow: 0 2px 6px rgb(0 0 0 / 0.1);
      scrollbar-width: thin;
      scrollbar-color: #61dafb transparent;
    }
    body.dark-mode .navbar { background-color: #1e1e1e; }
    .navbar a {
      color: #61dafb;
      text-decoration: none;
      padding: 10px 18px;
      font-weight: 600;
      font-size: 14px;
      border-radius: 6px;
      flex-shrink: 0;
      transition: background-color 0.3s ease, color 0.3s ease;
    }
    .navbar a:hover { background-color: #61dafb; color: #20232a; }

    /* Announcement banner styling */
    .announcement {
      background-color: #fff3cd;
      border: 1px solid #ffeeba;
      padding: 15px;
      border-radius: 8px;
      margin: 20px auto;
      max-width: 1000px;
    }
    .announcement a { color: #856404; font-weight: bold; text-decoration: underline; }

    /* Main container for content sections */
    .container {
      flex-grow: 1;
      display: flex;
      gap: 20px;
      padding: 20px;
      max-width: 1200px;
      margin: 20px auto;
      width: 100%;
    }
    /* Section styling for individual content blocks */
    .section {
      background: white;
      flex: 1;
      padding: 20px 25px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgb(0 0 0 / 0.05);
      max-height: 80vh; /* Set a max height for scrollability */
      overflow-y: auto; /* Enable vertical scrolling */
      scroll-behavior: smooth;
      transition: background 0.3s, color 0.3s, box-shadow 0.3s;
    }
    body.dark-mode .section { background: #1e1e1e; color: #f1f1f1; box-shadow: 0 4px 12px rgba(0,0,0,0.3); }
    
    /* Heading 2 styling */
    h2 {
      margin-top: 0;
      font-weight: 700;
      color: #20232a;
      border-bottom: 3px solid #61dafb;
      padding-bottom: 8px;
      margin-bottom: 16px;
      font-size: 22px;
    }
    body.dark-mode h2 { color: #61dafb; }

    /* Individual program item styling */
    .program-item {
      margin-bottom: 15px;
      padding: 12px;
      border-radius: 6px;
      background: #f1f1f1;
      transition: background 0.3s;
    }
    body.dark-mode .program-item { background: #2c2c2c; }
    .program-item h3 { margin: 0 0 8px; font-size: 16px; }
    .program-item p { margin: 0 0 10px; font-size: 14px; line-height: 1.5; }
    .program-item a { color: #61dafb; text-decoration: none; font-weight: 600; }
    .program-item a:hover { text-decoration: underline; }
    
    /* Search and Sort container styling */
    .search-container {
      margin-bottom: 20px;
      display: flex; /* Make it a flex container */
      gap: 10px; /* Space between search input and dropdown */
    }
    /* Search input field styling */
    .search-container input[type="text"] {
      flex-grow: 1; /* Allow input to take available space */
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 16px;
    }
    /* Sort dropdown styling */
    .search-container select {
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 16px;
      background-color: white; /* Ensure consistent background */
      cursor: pointer;
    }
    body.dark-mode .search-container select {
      background-color: #2c2c2c;
      color: #f1f1f1;
      border-color: #444;
    }

    /* Theme switch button wrapper and button styling */
    .theme-switch-wrapper {
      position: fixed;
      bottom: 20px;
      right: 20px;
    }
    .theme-switch button {
      background: #61dafb;
      border: none;
      border-radius: 50%;
      width: 42px;
      height: 42px;
      font-size: 18px;
      cursor: pointer;
      box-shadow: 0 2px 6px rgb(0 0 0 / 0.1); /* Add subtle shadow */
    }
    body.dark-mode .theme-switch button { background: #444; color: #fff; }

    /* LLM Program Generator styles */
    .program-generator {
        margin-top: 20px;
        padding-top: 20px;
        border-top: 1px solid #eee;
    }
    body.dark-mode .program-generator {
        border-top: 1px solid #333;
    }
    .program-generator h3 {
        margin-top: 0;
        margin-bottom: 10px;
        color: #20232a;
        font-size: 18px;
    }
    body.dark-mode .program-generator h3 {
        color: #f1f1f1;
    }
    .program-generator input[type="text"] {
        width: calc(100% - 70px); /* Adjust width to make room for button */
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
        font-size: 16px;
        margin-right: 10px;
    }
    .program-generator button {
        padding: 10px 15px;
        background-color: #61dafb;
        color: #20232a;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
        font-weight: 600;
        transition: background-color 0.3s ease;
    }
    .program-generator button:hover {
        background-color: #4ac6eb;
    }
    .program-generator #programOutput {
        margin-top: 15px;
        padding: 12px;
        border-radius: 6px;
        background: #f9f9f9;
        min-height: 50px;
        white-space: pre-wrap; /* Preserve whitespace and line breaks */
        word-wrap: break-word; /* Break long words */
        color: #333;
        border: 1px dashed #ccc;
    }
    body.dark-mode .program-generator #programOutput {
        background: #2c2c2c;
        color: #f1f1f1;
        border-color: #444;
    }
    .program-generator .loading {
        color: #61dafb;
        font-style: italic;
    }
  </style>
</head>
<body>
  <nav class="navbar">
    <a href="https://houselearning.github.io/home/">Home</a>
    <a href="https://houselearning.github.io/home/math-page.html">Math Games</a>
    <a href="https://houselearning.github.io/home/science-page.html">Science Fun</a>
    <a href="https://houselearning.github.io/home/computer-science-page.html">Coding Challenges</a>
    <a href="https://houselearning.github.io/home/games.html">Random Games</a>
    <a href="https://houselearning.github.io/safe-library">Safe Library</a>
    <a href="https://houselearning.github.io/audio">Audio Library</a>
    <a href="https://houselearning.github.io/about">About</a>
  </nav>

  <div class="announcement">
    <strong>üõ†Ô∏è Renovation:</strong> We‚Äôre currently making updates.  
    <a href="https://github.com/houselearning/developer-notes/discussions/5" target="_blank">Learn more here</a>.
  </div>

  <main class="container">
    <section class="section">
      <h2>Programs Library</h2>
      <p>Explore useful programs for various tasks:</p>
      
      <div class="search-container">
        <input type="text" id="searchInput" placeholder="Search for programs...">
        <select id="sortDropdown">
          <option value="default">Default</option>
          <option value="atoz">A-Z</option>
          <option value="ztoa">Z-A</option>
        </select>
      </div>

      <!-- Container for dynamically loaded program items -->
      <div id="programItemsContainer">
        <!-- Program items will be loaded here from program-list.json -->
      </div>

      <div class="program-generator">
        <h3>Generate Program Ideas with AI</h3>
        <p>Type in a concept (e.g., "game", "utility", "tool") and get a new program idea:</p>
        <div>
          <input type="text" id="programPromptInput" placeholder="e.g., a simple game">
          <button id="generateProgramBtn">Generate Idea</button>
        </div>
        <div id="programOutput"></div>
      </div>

    </section>
  </main>

  <div class="theme-switch-wrapper">
    <button id="theme-toggle">üåô</button>
  </div>

  <script>
    // Theme toggle functionality
    const btn = document.getElementById('theme-toggle');
    btn.addEventListener('click', () => {
      document.body.classList.toggle('dark-mode');
    });

    const programListContainer = document.getElementById('programItemsContainer');
    let allPrograms = []; // Store all programs for filtering and sorting

    // Function to render programs
    function renderPrograms(programsToRender) {
      programListContainer.innerHTML = ''; // Clear existing programs
      programsToRender.forEach(program => {
        const programItem = document.createElement('div');
        programItem.classList.add('program-item');
        programItem.innerHTML = `
          <h3>${program.title}</h3>
          <p>${program.description}</p>
          <a href="${program.link}">View Program</a>
        `;
        programListContainer.appendChild(programItem);
      });
    }

    // Function to fetch programs from JSON
    async function fetchPrograms() {
      try {
        const response = await fetch('program-list.json'); // Path to your JSON file
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        allPrograms = await response.json();
        renderPrograms(allPrograms); // Render initially
      } catch (error) {
        console.error('Error fetching program list:', error);
        programListContainer.innerHTML = '<p>Error loading programs. Please try again later.</p>';
      }
    }

    // Initial fetch of programs when the page loads
    document.addEventListener('DOMContentLoaded', fetchPrograms);

    // Search functionality for program items
    const searchInput = document.getElementById('searchInput');
    searchInput.addEventListener('input', (event) => {
      const searchTerm = event.target.value.toLowerCase();
      const filteredPrograms = allPrograms.filter(program => {
        const title = program.title.toLowerCase();
        const description = program.description.toLowerCase();
        return title.includes(searchTerm) || description.includes(searchTerm);
      });
      renderPrograms(filteredPrograms);
    });

    // Sorting functionality for program items
    const sortDropdown = document.getElementById('sortDropdown');
    sortDropdown.addEventListener('change', () => {
        const sortValue = sortDropdown.value;
        let sortedPrograms = [...allPrograms]; // Create a copy to sort

        sortedPrograms.sort((a, b) => {
            const textA = a.title.toLowerCase();
            const textB = b.title.toLowerCase();

            if (sortValue === 'atoz') {
                return textA.localeCompare(textB);
            } else if (sortValue === 'ztoa') {
                return textB.localeCompare(textA);
            }
            // For 'default', return 0 to maintain original order (or the order from JSON)
            return 0; 
        });
        renderPrograms(sortedPrograms);
    });

    // LLM Integration for Program Idea Generation
    const programPromptInput = document.getElementById('programPromptInput');
    const generateProgramBtn = document.getElementById('generateProgramBtn');
    const programOutput = document.getElementById('programOutput');

    generateProgramBtn.addEventListener('click', async () => {
        const prompt = programPromptInput.value.trim();
        if (!prompt) {
            programOutput.textContent = 'Please enter a concept to generate a program idea.';
            return;
        }

        programOutput.textContent = 'Generating idea...';
        programOutput.classList.add('loading');
        generateProgramBtn.disabled = true; // Disable button during generation

        try {
            let chatHistory = [];
            chatHistory.push({ role: "user", parts: [{ text: `Generate a creative program idea (title and a brief description) based on the concept: "${prompt}". Respond only with a JSON object like: {"title": "Program Title", "description": "Program Description"}` }] });
            const payload = { 
                contents: chatHistory,
                generationConfig: {
                    responseMimeType: "application/json",
                    responseSchema: {
                        type: "OBJECT",
                        properties: {
                            "title": { "type": "STRING" },
                            "description": { "type": "STRING" }
                        },
                        "propertyOrdering": ["title", "description"]
                    }
                }
            };
            const apiKey = "AIzaSyCkof5C1g4dOLVxenqYCtWvp6BPjnWcXD4"; 
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            const result = await response.json();
            
            if (result.candidates && result.candidates.length > 0 &&
                result.candidates[0].content && result.candidates[0].content.parts &&
                result.candidates[0].content.parts.length > 0) {
                const jsonText = result.candidates[0].content.parts[0].text;
                try {
                    const parsedIdea = JSON.parse(jsonText);
                    programOutput.innerHTML = `<strong>Title:</strong> ${parsedIdea.title}<br><strong>Description:</strong> ${parsedIdea.description}`;
                } catch (parseError) {
                    console.error('Error parsing JSON from LLM:', parseError);
                    programOutput.textContent = 'Failed to parse program idea. Please try again.';
                }
            } else {
                programOutput.textContent = 'Could not generate a program idea. Please try again.';
            }

        } catch (error) {
            console.error('Error calling Gemini API:', error);
            programOutput.textContent = 'Error generating idea. Please check your network connection or try again later.';
        } finally {
            programOutput.classList.remove('loading');
            generateProgramBtn.disabled = false; // Re-enable button
        }
    });

  </script>
</body>
</html>
