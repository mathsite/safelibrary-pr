
<!doctype html>
<html>
<head>
<meta charset="utf-8">
<script src="https://unpkg.com/@webcomponents/custom-elements"></script>
<script src="https://g200kg.github.io/webaudio-controls/webaudio-controls.js" ></script>
<script src="https://buddypond.com/v5/apps/based/piano/vendor/webaudio-tinysynth.js"></script>
<script>
async function Init(){
  synth=document.getElementById("tinysynth");
  kb=document.getElementById("keyboard");
  kb.addEventListener("change",KeyIn);

  await synth.ready();

  for(var i=0;i<128;++i){
    var o=document.createElement("option");
    o.innerHTML=(i+1)+" : "+synth.getTimbreName(0,i);
    document.getElementById("prog").appendChild(o);
  }
}
function Prog(pg){
  synth.send([0xc0,pg]);
}
function KeyIn(e){
  synth.send([0x90,e.note[1],e.note[0]?100:0]);
}
window.onload=function(){
  window.addEventListener("message", (event) => {
    // console.log('eventdata', event.data)
    synth.send([event.data[0], event.data[1], event.data[2]])
    //synth.send([0x90, 62, 1, 100])
  }, false);
  Init();
}

</script>
<style>
  body {
    background-image:url("https://houselearning.github.io/safe-library/programs/assets/background-main.jpeg");
  }
  h1 {
    color: white;
  }
    h2 {
    color: white;
  }
</style>
</head>
<body>
<h1>SafeLibrary Online Piano Tool</h1>
<hr>
<h2>This tool is playable with a keyboard</h2>
Bank : <select id="prog" onchange="Prog(this.selectedIndex)"></select>
<br/>
<!-- TODO: add width here, but it can't be a percentage?-->
<webaudio-keyboard id="keyboard" min="48"></webaudio-keyboard>
<br/>
<webaudio-tinysynth id="tinysynth"></webaudio-tinysynth>

<script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"rayId":"941b3ae3ee490f49","version":"2025.4.0-1-g37f21b1","r":1,"token":"a34dc8c1b1574dff985e9274c2469241","serverTiming":{"name":{"cfExtPri":true,"cfL4":true,"cfSpeedBrain":true,"cfCacheStatus":true}}}' crossorigin="anonymous"></script>
</body>
</html>
